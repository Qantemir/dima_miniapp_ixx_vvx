# Оптимизации производительности

## Выполненные оптимизации

### Бэкенд

1. **Подключение к MongoDB при старте**
   - БД подключается сразу при запуске сервера, а не при первом запросе
   - Это убирает задержку первого запроса (~500ms)

2. **Оптимизация Connection Pool**
   - `maxPoolSize: 50` - больше соединений для параллельных запросов
   - `minPoolSize: 10` - минимум соединений всегда готовы
   - `maxIdleTimeMS: 45000` - оптимизация времени жизни соединений

3. **Параллельные запросы к БД**
   - Каталог загружается параллельно (категории и товары одновременно)
   - Используется `asyncio.gather()` для параллельного выполнения

4. **Оптимизированные индексы**
   - Составные индексы для частых запросов
   - Индексы для фильтрации по статусу и дате
   - Индексы для быстрого поиска корзин

5. **Оптимизация запросов корзины**
   - Проверка истекших корзин без полной загрузки данных
   - Использование projection для загрузки только нужных полей

### Фронтенд

1. **Code Splitting (Lazy Loading)**
   - Страницы загружаются по требованию
   - Главная страница (CatalogPage) загружается сразу
   - Остальные страницы загружаются при переходе

2. **Оптимизация QueryClient**
   - `staleTime: 30s` - данные считаются свежими 30 секунд
   - `cacheTime: 5min` - кэш хранится 5 минут
   - `refetchOnWindowFocus: false` - не перезапрашивать при фокусе
   - `retry: 1` - только 1 попытка повтора

3. **Оптимизация сборки (Vite)**
   - Разделение vendor библиотек на отдельные чанки
   - Минификация через esbuild (быстрее чем terser)
   - CSS code splitting

4. **Уменьшенный таймаут запросов**
   - Таймаут уменьшен с 10s до 8s для быстрой обратной связи

## Дополнительные рекомендации

### Для дальнейшей оптимизации:

1. **Кэширование на уровне БД**
   - Использовать Redis для кэширования частых запросов
   - Кэшировать каталог на 1-2 минуты

2. **CDN для статических файлов**
   - Изображения товаров через CDN
   - Кэширование на уровне CDN

3. **Сжатие ответов**
   - Включить gzip/brotli compression в FastAPI
   - Уменьшит размер ответов на 70-80%

4. **Prefetching**
   - Предзагрузка данных при наведении на ссылки
   - Prefetch для страниц, которые пользователь может посетить

5. **Мониторинг производительности**
   - Добавить логирование времени выполнения запросов
   - Использовать APM инструменты (например, Sentry Performance)

## Ожидаемые результаты

- **Первый запрос**: с ~1000ms до ~300-400ms
- **Последующие запросы**: с ~579ms до ~200-300ms
- **Загрузка страниц**: с ~1-2s до ~300-500ms
- **Размер бандла**: уменьшение на 30-40% благодаря code splitting

