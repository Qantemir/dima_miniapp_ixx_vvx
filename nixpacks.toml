# –Ø–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (React + Vite)
# Railway –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ñ–∞–π–ª –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

[phases.setup]
nixPkgs = ["nodejs_20"]

[phases.install]
cmds = [
  "echo 'üî® Building frontend...'",
  "which node && node --version",
  "which npm && npm --version",
  "npm ci",
  "echo 'üì¶ Dependencies installed'",
  "ls -la node_modules/.bin/serve || echo '‚ö†Ô∏è serve not found in node_modules'"
]

[phases.build]
cmds = [
  "echo 'üèóÔ∏è  Building React app...'",
  "npm run build",
  "echo '‚úÖ Build completed'",
  "ls -la dist/ || echo '‚ö†Ô∏è WARNING: dist directory not found'",
  "ls -la dist/assets/ || echo '‚ö†Ô∏è WARNING: dist/assets directory not found'"
]

[start]
cmd = "echo 'üöÄ Starting frontend server...' && export PATH=$PATH:$(pwd)/node_modules/.bin && serve -s dist -l ${PORT:-3000}"

[variables]
NODE_ENV = "production"
NIXPACKS_NO_MOUNT_CACHE = "1"

